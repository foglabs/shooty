<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Shooty Blasters</title>
    <link href="game.css" rel="stylesheet">
  </head>

  <body>
    <div id="info"></div>

    <script src="three.js"></script>
    <script src="classes/game.js"></script>
    <script src="classes/timer.js"></script>
    <script src="classes/character.js"></script>
    <script src="classes/player.js"></script>
    <script src="classes/enemy.js"></script>
    <script>

      // run every frame
      function animate() {
        if(enemyTimer.running && enemyTimer.time() > 10 ){

          game.generateEnemies( Math.round(Math.random() * 50) )
          enemyTimer.reset()
        }


        player.handleMovement()



        game.moveEnemies()
        game.handleLife()

        player.animation()

        game.drawScore()

        requestAnimationFrame( animate );
        renderer.render( scene, camera );
      }

      // scene contains objects
      var scene = new THREE.Scene();
      // camera is passed into renderer, rather than as scene object
      var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
      camera.position.z = 5;



      let game = new Game()

      // to generate enemies every so often
      let enemyTimer = new Timer()
      enemyTimer.start()      


      let player = new Player([22,88,49])

      scene.add( player.mesh );
      // create bounding box object for intersection

      game.generateEnemies(20)


      // add grid
      var size = 10;
      var divisions = 10;
      var gridHelper = new THREE.GridHelper( size, divisions );
      gridHelper.rotation.x = 80;
      scene.add( gridHelper );

      // render has the beef (webgl) to draw each frame
      var renderer = new THREE.WebGLRenderer();
      renderer.setSize( window.innerWidth, window.innerHeight );

      animate();

      document.addEventListener("keydown", onDocumentKeyDownUp, false);
      document.addEventListener("keyup", onDocumentKeyDownUp, false);
      function changeSpeed(key){
        if (key == "ArrowLeft") {
            // console.log("left")
            player.accx -= 0.5;
        } else if (key == "ArrowUp") {
            // console.log("up")
            player.accy += 0.5;
        } else if (key == "ArrowRight") {
            // console.log("right")
            player.accx += 0.5;
        } else if (key == "ArrowDown") {
            // console.log("down")
            player.accy   -= 0.5;
        } else if (key == 32) {
            // console.log("fuck")
            playercube.position.set(0, 0, 0);
        }

      }
      let heldkeys = {};
      function onDocumentKeyDownUp(event) {
        heldkeys[event.key] = event.type == 'keydown';
        
        heldkeys_keys = Object.keys(heldkeys)

        // are any keys held down 
        if(heldkeys_keys){
          for(i=0; i<heldkeys_keys.length; i++){
            // is the key held down?
            let key = heldkeys_keys[i];
            if(heldkeys[key]){
              changeSpeed(event.key)
            }
          }
        }
        
        // console.log("playercube position is")
        // console.log(playercube.position)
      }

      document.body.appendChild( renderer.domElement );


    </script>

  </body>
</html>

